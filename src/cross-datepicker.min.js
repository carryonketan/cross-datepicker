/**
 *
 *  Cross-DatePicker
 *  Version 0.1
 *
 *  @lcnvdl
 *  http://www.lucianorasente.com
 *
 */
(function(){var e=function(e){return typeof e==="number"?e?e<0?-1:1:e===e?0:NaN:NaN};$.fn.insertAt=$.fn.insertAt||function(e,t){return this.each(function(){if(e===0){t.prepend(this)}else{t.children().eq(e-1).after(this)}})};$.fn.cdp=function(t){t=$.extend({},$.fn.cdp.defaults,t);var n=$(this);if(n.length==0){return this}else if(n.length>1){n.each(function(){$(this).crossdp()});return this}if(n.data("cross-datepicker")){return this}if(!n.is("input")){throw"You can apply Cross-DatePicker only on an 'input' element"}if(t.hideInput)n.hide();var r=$("<div>").addClass(t.classes.container||"").data("input",n).insertBefore(n);var i=[31,29,31,30,31,30,31,31,30,31,30,31];var s=$("<select>").addClass(t.classes.controls||"").addClass(t.classes.days||""),o=$("<select>").addClass(t.classes.controls||"").addClass(t.classes.months||""),u=$("<select>").addClass(t.classes.controls||"").addClass(t.classes.year||"");var a=function(e){var t={},n="",r=0,i={d:s,m:o,y:u};for(var a=0,f=e;a<f.length;a++){var l=f[a];if(n==l){t[l].count++}else if(l=="d"||l=="y"||l=="m"){t[l]={count:1,order:r++,e:i[l]};i[l].data("order",t[l].order);n=l}if(r>3){throw"Invalid date format"}}return t};var f=a(t.inputFormat),l=a(t.format);for(var c in l){l[c].e.appendTo(r)}r.sort(function(e,t){if(e.data("order")>t.data("order")){return 1}else if(e.data("order")<t.data("order")){return-1}else{return 0}});var h=function(e,t){var n=String(e),r=t||l.d.count;while(r>n.length){n="0"+n}return n};var p=function(e,n){if(e>12){throw"Invalid month: "+e}var r=n||l.m.count,i=String(e);if(r==2){if(i.length==1){i="0"+i}}else if(r==3){i=t.months[c-1].substr(0,3)}else if(r==4){i=t.months[c-1]}else{throw"Invalid month format"}return i};var d=function(e,t){var n=String(e),r=t||l.y.count;if(r==2){n=n.substr(n.length-2,2)}else if(r!=4){throw"Invalid year format"}return n};var v=function(){var e=["d","m","y"],r=t.inputFormat;for(var i=0;i<e.length;i++){var a=e[i],l=f[a],c="",v="";for(var m=0;m<l.count;m++){c+=a}if(a=="d"){v=h(parseInt(s.val()),l.count)}else if(a=="m"){v=p(parseInt(o.val()),l.count)}else{v=d(parseInt(u.val()),l.count)}r=r.replace(c,v)}n.val(r)};s.data("days",0);var m=function(e){if(s.data("days")==i[e-1]){return}var n=parseInt(s.val()||"1");s.html("");if(e==0){return}if(t.addNullOption){s.append("<option value=''>"+t.nullOptionText+"</option>")}for(var r=1;r<=i[e-1];r++){$("<option>").attr("value",r).text(h(r)).appendTo(s)}s.val(n)};s.change(function(){v()});m(1);o.change(function(){m(parseInt($(this).val()));v()});if(t.addNullOption){o.append("<option value='0'>"+t.nullOptionText+"</option>")}for(var c=1;c<=12;c++){o.append("<option value='"+c+"'>"+p(c)+"</option>")}var g,y;if(typeof t.years[0]=="string"){var b=(new Date).getFullYear(),w;if(t.years.length==3){b+=t.years[1];w=t.years[2]}else{w=t.years[1]}for(var c=b;c!=b+w;c+=e(w)){u.append("<option value='"+c+"'>"+d(c)+"</option>")}}else{for(var c=t.years[0];c!=t.years[1];c+=e(t.years[1]-t.years[0])){u.append("<option value='"+c+"'>"+d(c)+"</option>")}}u.change(function(){v()});v();n.data("cross-datepicker",true);return this};$.fn.cdp.defaults={hideInput:true,format:"d/mmm/yyyy",inputFormat:"yyyy-mm-dd",years:["now",-100],months:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],addNullOption:false,nullOptionText:"Select",classes:{container:"cdp-container",controls:"cdp-select",days:"cdp-d",months:"cdp-m",years:"cdp-y"}}})()
